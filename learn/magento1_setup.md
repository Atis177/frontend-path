# Настройка проекта на Magento 1.x

## Клонирование проекта
Доступ в репозиторий проекта выдает менеджер, который этим проектом занимается. Обращайтесь к менеджеру, не к администратору.

В каждом проекте есть файл `README.md`, в котором могут быть описаны шаги установки, специфические для проекта. Перед раскаткой нужно обязательно его прочитать. Проще всего это сделать на главной странице репозитория на Гитхабе.

После прочтения ридми клонируем проект.

## Настройка сервера
задать хосты на проект и конфигурацию
sudo service nginx restart

```
cd /etc/nginx/sites-available
cp [existigsite].loc [project-name].loc
```

Нужен дефолтный конфиг для Nginx.

Прописываем в `/etc/hosts` тот урл, который прописали в nGinx. Редактировать файл нужно под `sudo`: `sudo nano /etc/hosts`.

Прописываем путь к проекту в nginx.

Рестартуем nginx: `nginx.restart`.

## Настройка базы данных
Для работы проекта нужны данные: товары, структура каталога, пользователи и т. д. Если проект новый, то берется тестовая официальная [Magento Sample Data](http://devdocs.magento.com/guides/m1x/ce18-ee113/ht_magento-ce-sample.data.html) — дамп базы и картинки. Если работать нужно с уже существующим проектом или за основу берется готовый проект, то дамп базы нужно взять или у коллег или загрузить с дев-сервера.

Для работы с базой ее нужно создать. Запускаем MySQL:

```bash
mysql -uroot -p
```

Создаем базу с нужным именем:

```sql
create database [databasename];
```

Пустая база создана, теперь нужно ее заполнить. Для этого нужен дамп.

Дамп — набор SQL-инструкций в файле `[project-name].sql`. Эти инструкции формируют структуру базы и заносят в нее нужные данные. Раздампить базу через консоль можно так:

```bash
mysql -uroot -p db-name < path/to/sql-dump.sql
```

В Мадженто принято использовать абсолютные урлы для ссылок. Для их формирования в базе (таблица `core_config_data`) хранятся названия доменов и при работе на локалке их нужно заменить на свои, прописанные в файле `hosts` и настройках сервера.

Запускаем MySQL в баше: `mysql -uroot -p`.

Выбираем базу, которую раскатали: `use [project-name]`.

Меняем урлы с помощью пары SQL-запросов:

```sql
update core_config_data set value = 'http://[project-name].loc/' where path = 'web/unsecure/base_url';
update core_config_data set value = 'http://[project-name].loc/' where path = 'web/secure/base_url';
```

Перед работой нужно отключить объединение JS и CSS ресурсов. Это можно сделать в командной строке:

```sql
update core_config_data set value=0 where path like '%merge%';
```

или в админке: `Система/Конфигурация` выбрать слева `Для разработчика` и выбрать `Нет` в `Настройка CSS/JS`.

Возможно нужно будет сбросить пароль для админки на `admin/admin123`:

```sql
UPDATE admin_user SET password=CONCAT(MD5('qXadmin123'), ':qX') WHERE username='admin';
```

Если к вам пришел коллега и попросил дамп, сдампить базу можно так:

`mysqldump -uroot -p dbname > dump_name.sql`

Несколько полезных команд для работы в консоли MySQL:
`show databases;` — показать список баз данных.
`create database db_name;` — создать БД.


## Настройка Magento
Каждый проект имеет свои собственные настройки. Они хранятся в файле [local.xml](configs/magento/local.xml), который нужно положить в папку `app/etc/`.

Он не хранится в репозитории, потому что эти настройки отличаются на сервере и у разных разработчиков. Далее в `local.xml` нужно прописать нужные параметры: имя базы данных, пароль к СУБД и пр.

Мадженто хранит картинки товаров и прочие ресурсы в папке `media`. В папке `var` хранится кэш и логи. Эти папки нужно создать и дать им права на запись: `chmod -R 777 media`, `chmod -R 777 var`.

В папку `media` кладем ресурсы, которые можно попросить у коллег или скачать с дев-сервера.

## Установка зависимостей PHP
Если Composer не установлен в системе — устанавливаем его:

```bash
curl -sS https://getcomposer.org/installer | php
```

Запускаем установку зависимостей:

```bash
php composer.phar install
```

## Установка зависимостей NPM
Устанавливаем [NodeJS](http://nodejs.org), если не установлен.

Запускаем в корне проекта `npm install`.

Команды для работы с проектом обычно описаны в `README.md`. Так же их можно посмотреть в `package.json` в разделе `"scripts"`.

Обычно в проектах есть две команды: `npm run dev` для фронтэнд-разработки и `npm run prod` для бэкенда и продакшена.

