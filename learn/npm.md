# NPM
NPM — это пакетный менеджер. Он управляет зависимостями: наше приложение зависит от каких-то пакетов, а эти пакеты зависят от других пакетов и т. д. Изначально он создан для NodeJS, но сейчас там очень много всего и для фронтэнда.

## Материалы
* [Скринкаст по NodeJS](http://learn.javascript.ru/screencast/nodejs) — **обязательно** видео с 1 по 9. Минимально-необходимые знания по NodeJS.
* [What everybody should know about npm](https://www.youtube.com/watch?v=zWEU8kNKi3Q) + [слайды](http://slides.com/seldo/jsconf-budapest/#/) — **обязательно**.
* [Документаци NPM](https://docs.npmjs.com) — понятная документация с видео-примерами.
* [Рекомендуемые ссылки про NPM от технического директора NPM](https://github.com/seldo/awesome-npm)

## Установка
NPM устанавливается вместе с [NodeJS](https://nodejs.org/en/). Его так же можно поставить на Мак с помощью [`brew`](http://brew.sh) или на Линукс с помощью `apt`.

При установке глобальных пакетов на свежеустановленный NPM (например, `npm install -g webpack`) могут вылетать EACCES-ошибки. Это связано с недостаточнм уровнем доступа вашего пользователя к `/usr/local`, куда NPM ставит глобальные пакеты.

Права доступа настраиваются парой команд из [официального руководства](https://docs.npmjs.com/getting-started/fixing-npm-permissions). Вам нужен раздел [Option 1](https://docs.npmjs.com/getting-started/fixing-npm-permissions#option-1-change-the-permission-to-npms-default-directory).

:exclamation: Не нужно устанавливать глоабльные пакеты под `sudo`.

:+1: Вообще, стоит отдать предпочтение работе только с локальными пакетами. Так у всех на проекте будет одна и та же версия. См. ниже "[Запуск бинарников локально](#Запуск-бинарников-локально)".

## Версионирование
NPM использует соглашение [semver](https://docs.npmjs.com/getting-started/semantic-versioning): `MAJOR.MINOR.PATCH`.

При установке пакетв в `package.json` по-умолчанию записывается его версия с кочергой: `^1.2.3`. Это значит, что при последующих установках NPM будет искать в репозитории пакеты не ниже версии `1.2.3`, но не выше `2.0.0`. То есть все патчи и минорные изменения.

Часто используется `~`. Тильда позволяет устанавливать только патчи. Например, `~1.2.3` даст установить все версии `1.2.x` до `1.3.0`.

Для того, чтобы NPM не искал обновления установленных пакетов (при релизе может быть не безопасно), применяют утилиту [`npm shrinkwrap`](https://nodejs.org/en/blog/npm/managing-node-js-dependencies-with-shrinkwrap/).

## Чистка локального кэша
Если вдруг пропадет куда-то место на вашем SSD-диске, можно запустить `npm cache clean` и удалить закешированные пакеты. Каждый новый пакет кешируется для последующей быстрой установки. Их может накопиться очень много.

## Соглашения
В наших проектах часто используются следующие NPM-скрипты в `package.json`:

* `npm run dev` — запуск окружения для локальной фронтэнд-разработки. Нет минификации, запускается отдельный сервер для обслуживания ресурсов, все работает максимально быстро.
* `npm run prod` — сборка ресурсов для продадкшена (запускается на Дженкенсе) или локальной работы с собранными ресурсами, когда не нужно писать стили и JS (для бэкенд-разработки).

Скрипты, которые необходимо запускать в процессе работы с проектом, нужно упомянуть в `README.md`.

## Запуск бинарников локально
Некоторые пакеты поставляются с утилитами, которые можно запускать из командной строки: `gulp`, `webpack` и пр. Симлинки на них NPM собирает в папке `node_modules/.bin`.

Если такой NPM-пакет упоминается в разделе `"scripts"` в `package.json`, то NPM будет пытаться его запустить локально, из папки `node_modules`, которая находится в проекте. А если он его там не найдет, то попытается найти глобально.

Так, если в `package.json` есть, например, скрипт `"dev": "webpack-dev-server --hot"`, то, когда мы пишем в консоли `npm run dev`, запускается `webpack-dev-server` из папки `node_modules`, которая в проекте.

## Что нужно уметь
* Устанавливать пакеты из готового `package.json`.
* Создавать новый `package.json` и сохранять в него зависимости при установке пакетов.
* Понимать [semver](http://semver.org/lang/ru/).
* Устанавливать определенную версию пакета.
* Разбираться во всех этих `^` и `~`.
* Находить устаревшие пакеты из `package.json` из обновлять их.
* Чистить локальный кэш NPM.
* Знать, как залочить версии пакетов на проекте.
* Уметь работать с `npm run`-скриптами и скриптами по-умолчанию.
* Уметь добавить пакет в `package.json` из удаленного репозитория (Гтихаб, Битбакет и пр.).
* Понимать отличия между глобальными и локальными пакетами, уметь настроить npm-скрипты для работы только с локальными пакетами.
